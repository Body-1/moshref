<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محرر التصميم الاحترافي - 300+ قالب</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KaTeX & Marked -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/mhchem.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&family=Amiri:wght@400;700&family=Aref+Ruqaa:wght@400;700&family=Cairo:wght@300;400;700&family=El+Messiri:wght@400;700&family=Lalezar&family=Lemonada:wght@300;600&family=Rakkas&family=Reem+Kufi:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body { background-color: #e2e8f0; height: 100vh; overflow: hidden; font-family: 'Cairo', sans-serif; }
        
        /* ورقة A4 وتأثيراتها */
        .a4-wrapper { width: 100%; height: 100%; overflow-y: auto; display: flex; justify-content: center; padding: 40px 20px; scroll-behavior: smooth; }
        .a4-page { 
            width: 210mm; min-height: 297mm; background: white; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); 
            position: relative; transition: all 0.3s ease; transform-origin: top center;
        }

        /* جعل المعاينة قابلة للتحرير */
        #preview { outline: none; min-height: 250mm; }
        #preview:focus { border: 1px dashed #cbd5e1; }

        /* تخصيص المحتوى */
        .content-area h1 { font-weight: bold; margin-bottom: 0.5em; }
        .content-area p { margin-bottom: 1em; line-height: inherit; }
        
        /* القوالب الجانبية */
        .sidebar-panel { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); transform: translateX(100%); right: 0; }
        .sidebar-panel.active { transform: translateX(0); }

        /* تحسينات الواجهة */
        .toolbar-btn { @apply p-2 hover:bg-slate-200 rounded transition text-slate-700 flex items-center justify-center; }
        .control-label { @apply block text-[10px] font-bold text-slate-400 uppercase mb-1; }

        @media print {
            body { background: white; overflow: visible; }
            .no-print { display: none !important; }
            .a4-wrapper { padding: 0; display: block; background: white; }
            .a4-page { box-shadow: none; margin: 0; width: 100%; }
        }
    </style>
</head>
<body class="flex flex-col">

    <!-- Top Bar -->
    <header class="bg-slate-900 text-white h-14 shrink-0 flex items-center justify-between px-4 z-50 no-print">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-purple-600 rounded flex items-center justify-center"><i class="fa-solid fa-file-pen"></i></div>
            <h1 class="font-bold text-sm hidden md:block">محرر المجلات والوثائق الذكي</h1>
        </div>

        <!-- Word-like Quick Controls -->
        <div class="flex items-center gap-2 bg-slate-800 p-1 rounded-lg">
            <button onclick="execCommand('bold')" class="w-8 h-8 hover:bg-slate-700 rounded" title="عريض"><i class="fa-solid fa-bold"></i></button>
            <button onclick="execCommand('italic')" class="w-8 h-8 hover:bg-slate-700 rounded" title="مائل"><i class="fa-solid fa-italic"></i></button>
            <button onclick="execCommand('justifyRight')" class="w-8 h-8 hover:bg-slate-700 rounded"><i class="fa-solid fa-align-right"></i></button>
            <button onclick="execCommand('justifyCenter')" class="w-8 h-8 hover:bg-slate-700 rounded"><i class="fa-solid fa-align-center"></i></button>
            <div class="w-[1px] h-4 bg-slate-600 mx-1"></div>
            <select onchange="changeFontSize(this.value)" class="bg-transparent text-xs border-none outline-none cursor-pointer">
                <option value="12pt">12pt</option>
                <option value="14pt">14pt</option>
                <option value="18pt" selected>18pt</option>
                <option value="24pt">24pt</option>
            </select>
        </div>

        <div class="flex gap-2">
            <button onclick="toggleTemplates()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-1.5 rounded text-xs font-bold transition">
                <i class="fa-solid fa-palette ml-1"></i> القوالب الفنية
            </button>
            <button onclick="window.print()" class="bg-emerald-600 hover:bg-emerald-700 px-4 py-1.5 rounded text-xs font-bold transition">
                <i class="fa-solid fa-download ml-1"></i> تصدير
            </button>
        </div>
    </header>

    <main class="flex flex-1 overflow-hidden">
        
        <!-- Tools Sidebar (Left) -->
        <div class="w-64 bg-white border-l border-slate-200 flex flex-col no-print z-20 shadow-xl">
            <div class="p-4 space-y-6">
                <!-- Page Setup -->
                <section>
                    <h3 class="font-bold text-xs text-slate-800 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-arrows-up-down-left-right text-indigo-500"></i> إعدادات الصفحة
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="control-label">الهوامش (مم)</label>
                            <input type="range" min="5" max="50" value="25" oninput="updateMargin(this.value)" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div>
                            <label class="control-label">تباعد الأسطر</label>
                            <input type="number" step="0.1" value="1.8" onchange="updateLineHeight(this.value)" class="w-full p-1 border rounded text-xs">
                        </div>
                    </div>
                </section>

                <!-- Components -->
                <section>
                    <h3 class="font-bold text-xs text-slate-800 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-plus-circle text-emerald-500"></i> إضافة عناصر
                    </h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="insertText('# عنوان جديد')" class="toolbar-btn border text-[10px]"><i class="fa-solid fa-heading ml-1"></i> عنوان</button>
                        <button onclick="insertText('![Image](https://picsum.photos/400/200)')" class="toolbar-btn border text-[10px]"><i class="fa-solid fa-image ml-1"></i> صورة</button>
                        <button onclick="insertText('$$ E = mc^2 $$')" class="toolbar-btn border text-[10px]"><i class="fa-solid fa-square-root-variable ml-1"></i> معادلة</button>
                        <button onclick="insertText('| الجدول | القيمة |\n|---|---|')" class="toolbar-btn border text-[10px]"><i class="fa-solid fa-table ml-1"></i> جدول</button>
                    </div>
                </section>

                <div class="pt-4 border-t">
                    <label class="control-label italic text-slate-400">نصيحة: يمكنك الكتابة والتحريك مباشرة في الصفحة اليسرى</label>
                </div>
            </div>
            
            <!-- Raw Editor (Hidden by default or toggleable) -->
            <div class="mt-auto p-2 bg-slate-50 border-t">
                <button onclick="document.getElementById('raw-container').classList.toggle('hidden')" class="w-full py-2 text-[10px] text-slate-500 hover:text-indigo-600 font-bold">
                    إظهار المحرر البرمجي (Markdown)
                </button>
            </div>
        </div>

        <!-- Work Area -->
        <div class="flex-1 flex flex-col relative bg-slate-300">
            <!-- Hidden Markdown Editor -->
            <div id="raw-container" class="hidden absolute top-0 left-0 w-full h-40 bg-white z-30 shadow-lg border-b p-2">
                <textarea id="editor" class="w-full h-full p-2 font-mono text-xs outline-none" placeholder="Markdown..."></textarea>
            </div>

            <div class="a4-wrapper">
                <div id="print-area" class="a4-page">
                    <style id="dynamic-styles"></style>
                    <!-- ContentEditable makes it feel like Word -->
                    <div id="preview" contenteditable="true" class="content-area p-[25mm] shadow-inner"></div>
                </div>
            </div>
        </div>

        <!-- Templates Panel (Right Overlay) -->
        <div id="templates-panel" class="sidebar-panel absolute top-0 right-0 h-full w-80 bg-white shadow-2xl z-[60] no-print">
            <div class="p-5 flex flex-col h-full">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-bold text-slate-800">مكتبة القوالب (300+)</h2>
                    <button onclick="closeTemplates()" class="text-slate-400 hover:text-red-500 transition"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                
                <div class="mb-4">
                    <input type="text" id="template-search" oninput="filterTemplates(this.value)" placeholder="ابحث عن مجلة، تقرير، بوستر..." class="w-full p-2 border rounded-lg text-sm bg-slate-50">
                </div>

                <div id="template-list-container" class="flex-1 overflow-y-auto space-y-2 pr-1">
                    <!-- Templates items injected here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        const preview = document.getElementById('preview');
        const editor = document.getElementById('editor');
        const styleEl = document.getElementById('dynamic-styles');
        let currentTemplateSettings = {};

        // --- 1. Word-like Interactions ---
        function execCommand(command) {
            document.execCommand(command, false, null);
        }

        function changeFontSize(size) {
            preview.style.fontSize = size;
        }

        function updateMargin(val) {
            preview.style.padding = `${val}mm`;
        }

        function updateLineHeight(val) {
            preview.style.lineHeight = val;
        }

        // تحويل التحرير المباشر إلى Markdown في الخلفية (اختياري للمزامنة)
        preview.addEventListener('input', () => {
            // هنا يمكن إضافة منطق لتحويل HTML إلى Markdown إذا أردت مزامنة المحرر البرمجي
        });

        // --- 2. Advanced Template System (300+ Combinations) ---
        
        const config = {
            fonts: [
                { id: "f1", name: "كايرو", val: "'Cairo', sans-serif" },
                { id: "f2", name: "أميري", val: "'Amiri', serif" },
                { id: "f3", name: "رقعة", val: "'Aref Ruqaa', serif" },
                { id: "f4", name: "المسيري", val: "'El Messiri', sans-serif" },
                { id: "f5", name: "تجوال", val: "'Tajawal', sans-serif" },
                { id: "f6", name: "لالزار", val: "'Lalezar', cursive" }
            ],
            themes: [
                { id: "t1", name: "مجلة علمية", type: "magazine" },
                { id: "t2", name: "بوستر فني", type: "art" },
                { id: "t3", name: "تقرير رسمي", type: "formal" },
                { id: "t4", name: "مخطط تقني", type: "tech" },
                { id: "t5", name: "ريترو كلاسيك", type: "retro" },
                { id: "t6", name: "مينيمال (هادئ)", type: "minimal" }
            ],
            colors: [
                { name: "بنفسجي", p: "#6d28d9", s: "#f5f3ff" },
                { name: "كحلي", p: "#1e3a8a", s: "#eff6ff" },
                { name: "زمردي", p: "#047857", s: "#ecfdf5" },
                { name: "ذهبي", p: "#b45309", s: "#fffbeb" },
                { name: "وردي", p: "#be123c", s: "#fff1f2" },
                { name: "فحمي", p: "#1f2937", s: "#f3f4f6" },
                { name: "بترولي", p: "#0891b2", s: "#ecfeff" },
                { name: "برتقالي", p: "#c2410c", s: "#fff7ed" },
                { name: "زيتوني", p: "#3f6212", s: "#f7fee7" },
                { name: "توتو", p: "#86198f", s: "#fdf4ff" }
            ]
        };

        let templates = [];

        function generateTemplates() {
            let id = 1;
            config.themes.forEach(theme => {
                config.fonts.forEach(font => {
                    config.colors.forEach(color => {
                        templates.push({
                            id: id++,
                            name: `${theme.name} - ${font.name} (${color.name})`,
                            settings: { theme: theme.type, font: font.val, primary: color.p, secondary: color.s }
                        });
                    });
                });
            });
            renderTemplateList(templates);
        }

        function renderTemplateList(list) {
            const container = document.getElementById('template-list-container');
            container.innerHTML = list.map(t => `
                <div onclick="applyTemplate(${t.id})" class="p-3 border rounded-lg hover:border-indigo-500 cursor-pointer transition bg-slate-50 hover:bg-white flex items-center gap-3">
                    <div class="w-4 h-4 rounded-full" style="background:${t.settings.primary}"></div>
                    <span class="text-[11px] font-bold text-slate-700">${t.name}</span>
                </div>
            `).join('');
        }

        function filterTemplates(query) {
            const filtered = templates.filter(t => t.name.includes(query));
            renderTemplateList(filtered);
        }

        function applyTemplate(id) {
            const t = templates.find(x => x.id === id).settings;
            currentTemplateSettings = t;
            
            let css = `
                .a4-page { font-family: ${t.font}; }
                .content-area { color: #2d3748; }
            `;

            // أنماط مخصصة لكل نوع
            if (t.theme === 'magazine') {
                css += `
                    .content-area h1 { font-size: 42pt; text-align: center; color: ${t.primary}; border-bottom: 5px solid ${t.primary}; padding-bottom: 10px; text-transform: uppercase; }
                    .content-area h2 { background: ${t.primary}; color: white; display: inline-block; padding: 5px 20px; transform: skew(-15deg); margin: 20px 0; }
                    .content-area { column-count: 2; column-gap: 30px; text-align: justify; }
                    .content-area p::first-letter { font-size: 350%; font-weight: bold; color: ${t.primary}; float: right; margin-left: 10px; line-height: 1; }
                `;
            } else if (t.theme === 'art') {
                css += `
                    .a4-page { background: ${t.secondary}; border: 20px solid ${t.primary}; }
                    .content-area h1 { font-size: 48pt; text-align: right; color: ${t.primary}; line-height: 1; margin-top: 40px; }
                    .content-area h2 { font-size: 24pt; border-right: 10px solid ${t.primary}; padding-right: 15px; }
                    .content-area { text-align: right; }
                `;
            } else if (t.theme === 'formal') {
                css += `
                    .content-area h1 { text-align: center; border-bottom: 1px solid #ccc; padding-bottom: 20px; font-size: 24pt; }
                    .content-area h2 { color: ${t.primary}; font-weight: bold; border-right: 4px solid ${t.primary}; padding-right: 10px; }
                `;
            } else if (t.theme === 'tech') {
                css += `
                    .a4-page { background-image: linear-gradient(${t.secondary} 1px, transparent 1px), linear-gradient(90deg, ${t.secondary} 1px, transparent 1px); background-size: 20px 20px; }
                    .content-area h1 { font-family: monospace; background: #333; color: #fff; padding: 10px; }
                    .content-area h2 { font-family: monospace; color: ${t.primary}; border: 1px solid ${t.primary}; padding: 5px; }
                `;
            } else if (t.theme === 'retro') {
                css += `
                    .a4-page { background: #fdf6e3; filter: sepia(0.2); border: 2px solid #d3af37; }
                    .content-area h1 { font-family: 'Amiri'; text-align: center; font-size: 35pt; text-decoration: underline; color: #5d4037; }
                    .content-area h2 { font-style: italic; color: #8d6e63; border-bottom: 1px dotted #8d6e63; }
                `;
            } else { // Minimal
                css += `
                    .content-area h1 { font-weight: 300; font-size: 30pt; letter-spacing: -1px; }
                    .content-area h2 { font-weight: 400; color: ${t.primary}; }
                `;
            }

            styleEl.innerHTML = css;
        }

        // --- 3. UI Helper ---
        function toggleTemplates() { document.getElementById('templates-panel').classList.toggle('active'); }
        function closeTemplates() { document.getElementById('templates-panel').classList.remove('active'); }

        function insertText(text) {
            // إضافة النص ثم إعادة الرندر
            editor.value += "\n" + text;
            renderMarkdown();
        }

        function renderMarkdown() {
            const raw = editor.value;
            preview.innerHTML = marked.parse(raw);
            renderMathInElement(preview, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false}
                ],
                throwOnError: false
            });
        }

        editor.addEventListener('input', renderMarkdown);

        function loadSample() {
            editor.value = `# عنوان المجلة الفنية
## قصة التصميم والإبداع
هنا تبدأ رحلتك في تصميم صفحات احترافية. يمكنك الضغط على أي جزء من هذا النص لتعديله فوراً كأنك تستخدم برنامج وورد.

### المكونات العلمية
يمكنك إضافة معادلات رياضية معقدة مثل:
$$ \\int_{0}^{\\infty} e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2} $$

وأيضاً جداول منسقة:
| العنصر | القوة | التأثير |
|---|---|---|
| الخط العربي | عالي | بصري |
| التدرج اللوني | متوسط | جمالي |

يمكنك تغيير القوالب من القائمة الجانبية لتشاهد كيف يتغير شكل هذا المحتوى تماماً.`;
            renderMarkdown();
        }

        window.onload = () => {
            generateTemplates();
            loadSample();
            applyTemplate(1); // البدء بقالب المجلة الأول
        };
    </script>
</body>
</html>
